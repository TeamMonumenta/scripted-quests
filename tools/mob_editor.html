<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>ScriptedQuests Mob Editor</title>

    <!-- Foundation CSS framework (Bootstrap and jQueryUI also supported) -->
    <link rel='stylesheet' href='//cdn.jsdelivr.net/bootstrap/3.2.0/css/bootstrap.css'>
    <!-- Font Awesome icons (Bootstrap, Foundation, and jQueryUI also supported) -->
    <link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.6.1/css/all.css'>

    <script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@1.3.5/dist/jsoneditor.min.js"></script>
</head>
<body>
<div class='container'>
    <div class='row' style='padding-bottom: 15px;'>
        <div class='col-md-12'>
            <h1>ScriptedQuests Mob Editor</h1>
            <p>For the SFRPG Project, by Nova/Fire.</p>
			<br>
			<p>Allows for easy editing and compiling of mobs for SFRPG.</p>
        </div>
    </div>
    <div class='row' style='padding-bottom: 15px;'>
        <div class='col-md-12'>
            <button id='restore' class='btn btn-info'>Restore to Default</button>
            <span id='valid_indicator' class='label label-success'></span>
        </div>
    </div>
    <div class='row'>
        <div class='col-md-12'>
            <div id='editor_holder'></div>
        </div>
    </div>
</div>

<script>
       // Initialize the editor
    var editor = new JSONEditor(document.getElementById('editor_holder'),{
        theme: 'bootstrap3',
        iconlib: 'fontawesome5',

        // Enable fetching schemas via ajax
        ajax: true,

        // The schema for the editor
        schema: {
            title: "RPG Mob",
            defaultProperties: [
                "id",
				"name",
				"level",
				"entityType",
				"chestLoc",
				"knockbackResistance",
				"unpushable",
				"ai",
				"tags",
				"health",
				"speed",
				"loottable",
				"vision",
				"aggroRange",
				"visible",
				"defense_values",
				"damage_values",
				"xp_values",
				"sounds",
				"ranged",
				"targetTags",
				"abilities",
				"on_spawn",
                "quest_components"
            ],
            additionalProperties:false,
            properties: {
                id: {
                    required: true,
                    propertyOrder: 1,
                    title: "id",
                    description: "Unique mob name. For internal use only. Never change this once set unless necessary",
                    type: "string",
                    default: "rpg_mob"
                },
				name: {
                    required: true,
                    propertyOrder: 2,
                    title: "name",
                    description: "The name of the mob. This will be the displayed name.",
                    type: "string",
                    default: "RPG Mob"
                },
				level: {
                    required: true,
                    propertyOrder: 3,
                    title: "level",
                    description: "The level of the mob.",
                    type: "integer",
                    default: 1
                },
				entityType: {
                    required: true,
                    propertyOrder: 4,
                    title: "entityType",
                    description: "The EntityType of a mob. Head to this link to choose which EntityType: https://hub.spigotmc.org/javadocs/spigot/org/bukkit/entity/EntityType.html",
                    type: "string",
                    default: "ZOMBIE"
                },
				chestLoc: {
                    propertyOrder: 5,
                    title: "chestLoc",
                    description: "The location of the chest for the mob's equipment. format is 'world,x,y,z'",
                    type: "string"
                },
                knockbackResistance: {
                    propertyOrder: 5,
                    title: "knockbackResistance",
                    description: "The amount of resistance to velocity-setting skills. 0 = 0%, 1 = 100% Resistance",
                    type: "number",
					default: 0
                },
				meleeKnockbackResistance: {
                    propertyOrder: 5,
                    title: "meleeKnockbackResistance",
                    description: "The amount of knockback resistance to melee. 0 = 0%, 1 = 100% Resistance",
                    type: "number",
					default: 0
                },
				npcKnockbackResistance: {
                    propertyOrder: 7,
                    title: "npcKnockbackResistance",
                    description: "The amount of knockback resistance to melee. 0 = 0%, 1 = 100% Resistance",
                    type: "number",
					default: 0
                },
				unpushable: {
                    propertyOrder: 5,
                    title: "unpushable",
                    description: "Whether or not this mob can be pushed by players",
                    type: "boolean",
					default: false
                },
				ai: {
				    required: true,
                    propertyOrder: 5,
                    title: "ai",
                    description: "The Mob AI Type. Valid types: FRIENDLY, NEUTRAL, HOSTILE",
                    type: "string",
					default: "HOSTILE"				
				},
                health: {
				    required: true,
                    propertyOrder: 6,
                    title: "health",
                    description: "The health of a mob.",
					oneOf: [
						{
							title: "number",
							description: "Specific number of health for the mob to have.",
							type: "integer",
							default: 100
						},
						{
							title: "formulaic",
							description: "Generates the mob's HP based on a series of parameters given. Use this for easy calculations and accurate math.",
							properties: {
								playerLevel: {
								    required: true,
									title: "playerLevel",
									description: "The level of the player(s) that are expected to fight this mob",
									type: "number",
									default: 1
								},
								timeToKill: {
								    required: true,
									title: "timeToKill",
									description: "The PREDICTED time needed to kill this mob (in SECONDS)",
									type: "number",
									default: 10
								},
								dpsFactor: {
								    required: true,
									title: "dpsFactor",
									description: "The percentage to multiply the DPS by to get a player's predicted DPS via Attributes. This is given as a decimal from 0 - 1, and can be done numerically or formulaically",
									oneOf: [
										{
											title: "percent",
											description: "The DPS factor in terms of a percent from 0 - 1.",
											type: "number,
											default: 0.2
										},
										{
										    required: true,
											title: "formulaic",
											description: "Generates the DPS Factor using the given parameters",
											properties: {
												playerRarity: {
													title: "playerRarity",
													description: "The expected rarity of the gear that the player has. Valid options: Common, Uncommon, Rare, Epic, Legendary. CASE-SENSITIVE",
													type: "string",
													default: "Common"
												},
												includeAccessories: {
													title: "includeAccessories",
													description: "Whether the player is expected to have accessories that grant them additional attributes. This is useful for lower levels.",
													type: "boolean",
													default: false
												}
											},
											type: "object"
										}
									]
								},
								skillCount: {
								    required: true,
									title: "skillCount",
									description: "The amount of skills that a player is expected to have when fighting this boss. These only include ACTIVE/CASTABLE Skills, and not Passive Skills.",
									type: "number",
									default: 1
								},
								damageReduction: {
								    required: true,
									title: "damageReduction",
									description: "The predicted damage reduction that the mob will have against attacks. This should be a decimal from 0 - 1",
									type: "number",
									default: 0.2
								},
								zeroRounding: {
									title: "zeroRounding",
									description: "The amount of zeroes to round the health by. Used for fancier rounding.",
									type: "integer",
									default: 1
								}
							},
							type: "object"
						}
					]
                },
				speed: {
                    propertyOrder: 6,
                    title: "speed",
                    description: "The speed of a mob.",
                    type: "number",
					default: 0.25
                },
				vision: {
                    propertyOrder: 7,
                    title: "vision",
                    description: "The vision of a mob. This will determine how far their aggro distance is.",
                    type: "integer",
					default: 10
                },
				attackSpeed: {
                    propertyOrder: 7,
                    title: "attackSpeed",
                    description: "The speed at which the mob will melee attack. This is in SECONDS",
                    type: "number",
					default: 1
                },
				attackRange: {
                    propertyOrder: 7,
                    title: "attackRange",
                    description: "The range at which the mob will attack the player.",
                    type: "number",
					default: 1.5
                },
				aggroRange: {
                    propertyOrder: 7,
                    title: "aggroRange",
                    description: "The aggro range of a mob. This will determine how far a player can be before the mob loses aggro of the player.",
                    type: "integer",
					default: 22
                },
				npcHealthMinimum: {
                    propertyOrder: 7,
                    title: "npcHealthMinimum",
                    description: "The minimum amount of health (in %) that this mob can go down to while fighting an NPC. This prevents an NPC from dying to another NPC. Value of 0-1, use decimals.",
                    type: "number",
					default: 0
                },
				knockback: {
                    propertyOrder: 7,
                    title: "knockback",
                    description: "The knockback modifier of the mob when they melee an enemy. This is a decimal, and scales the same amount as weapon knockback modifiers. 0 = No knockback",
                    type: "number",
					default: 0
                },
				visible: {
                    propertyOrder: 7,
                    title: "visible",
                    description: "Whether the mob has the invisiblity effect on or not",
                    type: "boolean",
					default: true
                },
				invulnerable: {
                    propertyOrder: 7,
                    title: "invulnerable",
                    description: "Whether the mob is invulnerable or not. Invulnerable mobs cannot be targeted by abilities.",
                    type: "boolean",
					default: false
                },
				gravity: {
                    propertyOrder: 7,
                    title: "gravity",
                    description: "Whether this mob has gravity or not.",
                    type: "boolean",
					default: true
                },
				hideName: {
                    propertyOrder: 7,
                    title: "hideName",
                    description: "Hides the name and HP status of the mob.",
                    type: "boolean",
					default: false
                },
				seeThroughWalls: {
                    propertyOrder: 7,
                    title: "seeThroughWalls",
                    description: "Whether this mob will able to detect enemies through walls and platforms. Useful for wall archers",
                    type: "boolean",
					default: false
                },
				turnable: {
                    propertyOrder: 7,
                    title: "turnable",
                    description: "Toggles on/off whether or not this mob will look around and look at players.",
                    type: "boolean",
					default: true
                },
				friendlyFire: {
                    propertyOrder: 7,
                    title: "friendlyFire",
                    description: "Toggles on/off friendly fire, meaning the PLAYER is able to damage this mob if this is toggled on. Other NPCs can still damage this mob.",
                    type: "boolean",
					default: true
                },
				loottable: {
                    propertyOrder: 8,
                    title: "loottable",
                    description: "The Loot Table that the mob uses to drop items.",
                    type: "string",
					default: ""
                },
				conditional_loottables: {
                    propertyOrder: 8,
                    title: "conditional_loottables",
                    description: "Loot Tables that dropped based on the conditions met for the player. These loot tables also drop PER PLAYER (Meaning if a player kills the mob and is in a party, then all of the party gets personal drops from this loot table).",
                    type: "array",
					items: {
						title: "Conditional Loottable",
						type: "object",
						properties: {
							prerequisites: {
								title: "prerequisites",
								description: "The prerequisites for this loot table to drop for the player. Leave blank if there are no prerequisites.",
								$ref: "schema/prerequisites.json"
							},
							loottable: {
								title: "loottable",
								description: "The loot table to drop if the preprequisites are met.",
								type: "string"
							}
						}
					}
                },
				model: {
                    propertyOrder: 8,
                    title: "model",
                    description: "The Armor Stand Model id that is attached to the entity at all times. Leave blank for none.",
                    type: "string",
					default: ""				
				},
				skinPack: {
                    propertyOrder: 8,
                    title: "skinPack",
                    description: "The Skin Pack to use for this mob, which will be used to randomly assign the mob a skin.",
					type: "string",
					default: ""	
                },
				skin: {
                    propertyOrder: 8,
                    title: "skin",
                    description: "The Skin Information for the mob. For this to work, the mob has to be an entity type of PLAYER. To generate skin data, use https://mineskin.org/",
					properties: {
                        skin_data: {
                            title: "skin_data",
                            description: "The skin data for the skin .png",
							type: "string",
                        },
                        skin_signature: {
                            title: "skin_signature",
                            description: "The skin signature for the skin .png",
							type: "string",
                        },
                    }
                },
				skins: {
                    propertyOrder: 8,
                    title: "skins",
                    description: "The skins that the mob can have. This skin will be assigned at random.",
					type: "array",
					items: {
						title: "Skin",
						type: "object",
						properties: {
							skin_data: {
								title: "skin_data",
								description: "The skin data for the skin .png",
								type: "string"
							},
							skin_signature: {
								title: "skin_signature",
								description: "The skin signature for the skin .png",
								type: "string"
							}
						}
                    }
                },
				strafe_settings: {
                    propertyOrder: 11,
                    title: "strafe_settings",
                    description: "Giving monsters the ability to strafe their targets. Leave this off if you don't wish to have this.",
					properties: {
                        distance: {
                            title: "distance",
                            description: "The distance at which the mob starts to strafe the target",
							type: "number",
							default: 16
                        },
                        spacing: {
                            title: "spacing",
                            description: "The amount of spacing that must be retained between the target and the mob. When the mob reaches this distance from the target, they will stop approaching them.",
							type: "number",
							default: 2
                        },
                        switch_frequency: {
                            title: "switch_frequency",
                            description: "The frequency at which the mobs changes strafing directions (left or right). Between 0 - 1",
							type: "number",
							default: 0.3
                        },
                        speed: {
                            title: "speed",
                            description: "The speed at which the mob strafes its target. Typically keep this the same value as the mob's actual speed.",
							type: "number",
							default: 0.3
                        }
                    }
                },
				defense_values: {
                    propertyOrder: 9,
                    title: "defense_values",
                    description: "The defense values of each mob, regarding Defense, Armor, and Resistance",
                    $ref: "schema/defenses.json"
                },
				damage_values: {
                    propertyOrder: 10,
                    title: "damage_ranges",
                    description: "The damage values of each mob, regarding Physical Damage, and Magical Damage",
					minItems: 1,
					defaultProperties: [
                        "physical_damage"
                    ],
                    $ref: "schema/damage_ranges.json"
                },
				xp_values: {
                    propertyOrder: 11,
                    title: "xp_values",
                    description: "The amount of XP that the mob gives.",
					oneOf: [
						{
							title: "number",
							description: "Specific number of XP to give.",
							type: "integer"
						},
						{
							title: "percent",
							description: "Gives XP based on the amount of XP needed to get to the next level specified",
							properties: {
								level: {
									title: "level",
									description: "The level to base the XP given off of.",
									type: "integer"
								},
								percent: {
									title: "percent",
									description: "The percentage of XP to get to get to the next level based on the level specified. This should be a decimal between 0 - 1",
									type: "number"
								}
							},
							type: "object"
						}
					]
                },
				sounds: {
                    propertyOrder: 12,
                    title: "sound",
                    description: "The sounds for the mob",
                    properties: {
                        soundAmbient: {
                            title: "sound_ambient",
							type: "array",
							items: {
							    $ref: "schema/sound.json"
							},
                            propertyOrder: 1
                        },
                        soundHurt: {
                            title: "sound_hurt",
							type: "array",
							items: {
							    $ref: "schema/sound.json"
							},
                            propertyOrder: 2
                        },
						soundDeath: {
                            title: "sound_death",
							type: "array",
							items: {
							    $ref: "schema/sound.json"
							},
                            propertyOrder: 2
                        },
                    }
                },
				tags: {
                    propertyOrder: 13,
                    title: "tags",
                    description: "Tags for the mob. Can have multiple",
                    type: "array",
                    items: {
                        type: "string"
                    }
                },
				targetTags: {
                    propertyOrder: 13,
                    title: "targetTags",
                    description: "The tags that will cause the mob to target a nearby entity. Can have multiple",
                    type: "array",
                    items: {
                        type: "string"
                    }				
				},
				
				abilities: {
                    propertyOrder: 13,
                    title: "ability",
                    description: "The abilities for this mob. Must specify the mob ability ID",
                    type: "array",
                    items: {
                        type: "string"
                    }
                },
				ranged: {
				    title: "ranged",
                    description: "Use if you want to give the mob a ranged property",
                    $ref: "schema/ranged.json",
					propertyOrder: 14
				},
				on_spawn: {
					title: "on_spawn",
					description: "The actions to play on the mob whenever they first spawn. This can be left blank.",
					$ref: "schema/ability_actions.json"
				},
				on_targethit: {
					title: "on_targethit",
					description: "The actions to play on the target hit by the mob when struck by a melee. This can be left blank.",
					$ref: "schema/ability_actions.json"
				},		
				on_damaged: {
					title: "on_damaged",
					description: "The actions to play on the mob when they are damaged. This can be left blank.",
					$ref: "schema/ability_actions.json"
				},		
				on_attack: {
					title: "on_attack",
					description: "The actions to play on the mob when they attack. This can be left blank.",
					$ref: "schema/ability_actions.json"
				},					
				on_death: {
					title: "on_death",
					description: "The actions to play whenever the mob dies",
					$ref: "schema/ability_actions.json"
				},	
				on_tick: {
					title: "on_tick",
					description: "The actions to play each amount of ticks",
					type: "array",
					items: {
						type: "object",
						properties: {
							tickRate: {
								title: "tickRate",
								description: "The rate at which these actions tick.",
								type: "integer",
								default: 1
							},
							actions: {
								title: "actions",
								description: "The actions to perform",
								$ref: "schema/ability_actions.json"
							}
						}
					}
				},					
                quest_components: {
                    required: true,
                    propertyOrder: 15,
                    title: "quest_components",
                    description: "A list of actions with associated prerequisites to perform when the mob dies to a player.",
                    type: "array",
                    format: "tabs",
                    minItems: 1,
                    items: {
                        title: "Quest component",
                        $ref: "schema/quest_component.json",
                    }
                }
            }
        }
    });

    // Hook up the Restore to Default button
    document.getElementById('restore').addEventListener('click',function() {
        editor.setValue(starting_value);
    });

    // Hook up the validation indicator to update its
    // status whenever the editor changes
    editor.on('change',function() {
        // Get an array of errors from the validator
        var errors = editor.validate();

        var indicator = document.getElementById('valid_indicator');

        // Not valid
        if(errors.length) {
            indicator.className = 'label label-danger'
            indicator.textContent = "not valid";
        }
        // Valid
        else {
            indicator.className = 'label label-success'
            indicator.textContent = "valid";
        }
    });
</script>
</body>
</html>
